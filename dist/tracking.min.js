const UTM_SOURCE_SEO="seo",UTM_SOURCE="utm_source",UTM_MEDIUM="utm_medium",COOKIE_KEY="current_params_session",PREFIX="TRACKING",DEBUG=!1,log=()=>{};function setSessionCookie(t,e,n={}){const o=[`${t}=${encodeURIComponent(e)}`,"Path=/","SameSite=Lax"];n.domain&&o.push(`Domain=${n.domain}`),"https:"===location.protocol&&o.push("Secure"),document.cookie=o.join("; ")}function getCookie(t){const e=document.cookie.match(new RegExp("(?:^|; )"+t.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&")+"=([^;]*)"));return e?decodeURIComponent(e[1]):""}function getCookieOptsForCurrentHost(){const t=location.hostname||"",e={};return("finapartner.com"===t||t.endsWith(".finapartner.com"))&&(e.domain=".finapartner.com"),e}function initTracking(){let t=!1,e=!1,n=!1,o=!1,r=null;function i(){if(window.__utmBaselineStr&&"string"==typeof window.__utmBaselineStr)return new URLSearchParams(window.__utmBaselineStr);const t=new URLSearchParams(window.location.search),e=[...t.keys()].some(t=>t.startsWith("utm_")),n=getCookie(COOKIE_KEY),o=/^https?:\/\/(www\.)?google\./i.test(document.referrer);if(e){const e=t.toString();return setSessionCookie(COOKIE_KEY,e,getCookieOptsForCurrentHost()),window.__utmBaselineStr=e,new URLSearchParams(e)}if(o){const e=new URLSearchParams(t);e.set(UTM_SOURCE,"seo"),e.set(UTM_MEDIUM,"seo");const n=e.toString();return setSessionCookie(COOKIE_KEY,n,getCookieOptsForCurrentHost()),window.__utmBaselineStr=n,new URLSearchParams(n)}if(n)return window.__utmBaselineStr=n,new URLSearchParams(n);const r=t.toString();return window.__utmBaselineStr=r,new URLSearchParams(r)}function a(t){log("applyParamsToLinks",t.toString()),document.querySelectorAll('a[href*="registro.finapartner.com"]').forEach(e=>{try{const n=new URL(e.href);t.forEach((t,e)=>n.searchParams.set(e,t)),e.href=n.toString()}catch(t){console.error("Error procesando URL:",e.href,t)}log("link",e.href)})}let c=i();function s(){r&&clearTimeout(r),r=setTimeout(()=>{c=i(),log("reapply (debounced) currentParams:",c.toString()),a(c),setTimeout(()=>{a(i())},150)},50)}log("currentParams:",c.toString()),a(c),function(){if(window.__trackingSpaHookInstalled)return;window.__trackingSpaHookInstalled=!0;const t=history.pushState,e=history.replaceState;history.pushState=function(){const e=t.apply(this,arguments);return window.dispatchEvent(new Event("locationchange")),e},history.replaceState=function(){const t=e.apply(this,arguments);return window.dispatchEvent(new Event("locationchange")),t},window.addEventListener("popstate",function(){window.dispatchEvent(new Event("locationchange"))}),window.addEventListener("hashchange",function(){window.dispatchEvent(new Event("locationchange"))})}(),window.addEventListener("locationchange",function(){s()});try{new MutationObserver(t=>{for(const e of t)if(e.addedNodes&&e.addedNodes.length>0){s();break}}).observe(document.body,{childList:!0,subtree:!0})}catch(t){}document.querySelectorAll("a").forEach(n=>{n.addEventListener("click",function(){if("undefined"!=typeof fbq){const o=n.getAttribute("href")||"";o.startsWith("https://wa.me/")&&!t?(fbq("track","Contact"),t=!0):o.includes("registro.finapartner.com")&&!e&&(fbq("track","RegistroIniciado"),e=!0)}})});const d=document.querySelector('article[role="presentation"]');d&&d.addEventListener("click",function(){"undefined"==typeof fbq||n||(fbq("track","WatchVideo"),n=!0)}),window.addEventListener("scroll",function(){const t=window.scrollY||window.pageYOffset,e=.3*document.body.scrollHeight;!o&&t>e&&"undefined"!=typeof fbq&&(fbq("track","ViewContent"),o=!0)})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",initTracking,{once:!0}):initTracking();